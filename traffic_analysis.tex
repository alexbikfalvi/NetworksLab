\chapter{Traffic Analysis}

\section{Introduction}
The goal of this lab assignment is to know and use monitoring and traffic analysis tools.
\emph{Wireshark} and \emph{tcpdump} will be used to study different layers of the TCP/IP architecture.

\section{Preparation at home}

Review the TCP/IP model and explain the function of each layer.
Provide examples of the protocols at each layer of the protocol stack.

What is the purpose of ARP?
Draw a sketch of the different messages being exchanged and the different steps involved.
Is it possible to run this protocol between computers that are in different local area networks (LANs)?

What is the ICMP protocol?
How does the \emph{ping} command work?
What does the \emph{ping} command measure?

Explain and draw an SSL connection indicating how the protocol works and which messages are being exchanged.

\section{WireShark Network Analyzer}

Start the WireShark software and choose the right network interface.
The option Capture/Interfaces starts the packet capture.
It is also possible to configure the length of the capture and other details.
What interface does WireShark detect?
What is your IP address?
And the corresponding MAC?

Configure the Capture/Interfaces options to perform a five minutes capture.
Observe the results and answer the following questions:

What is the total number of captured packets?
Are there lost packets?
If yes, why?

Choose any packet.
Observe the details and answer the following questions:
What is the source and destination IP address?
What are the source and destination MAC addresses?
What is the number of bytes in the packet?
What protocols can you see in the packet?
Is there HTTP?
If yes, what is the length of the HTTP message?
What are the source and destination port?

In the menu ``Analyze option/Enable protocol'' it is possible to configure the protocols that WireShark will capture and show.
Looking at the default protocols, find at least one protocol of each of the four upper layers of the TCP/IP stack (Application/Transport/Internet/Link).
Include a brief description of the protocols you found.

Go to the menu ``Statistics/Protocol Hierarchy'' and observe the percentage of the following protocols: Ethernet, Internet Protocol, TCP, UDP, Logical Link Control, ARP, STP, IPv6, HTTP.

What are the differences between IP and IPv6?

\section{the ARP protocol}
The Address Resolution Protocol (ARP) protocol resolves the association between an IP address and a MAC address.
It is used in IP over Ethernet networks.
Capture traffic and analyze the ARP packets.
You can filter the ARP packets writing ``ARP'' in the ``Filter Toolbar''.

What are the source and destination MAC addresses of the Ethernet frame that contains the ARP request message?
Can you see the source and destination IP addresses in the ARP request frame?

Look for an ARP request-reply exchange and write the source and destination MAC and IP addresses.

Whats the time elapsing between an ARP request and reply messages?

Use the information available in WireShark to indicate the length of the ARP frames and draw the format of the messages.

To which layer does ARP belong?

\section{HTTP and secure HTTP}

Make a new 5 minutes capture and during this time visit a few webpages.
After the capture is finished observe the different HTTP and HTTPS messages.
Use the filter toolbar to filter the messages.

Observe an HTTP GET message and the corresponding response and answer the following questions:

What is the HTTP version of your web browser?
And the HTTP version of the server?
What language does the client request to the server?

Is it possible to find which are the URLs visited by the user?
At which layer is this information available?

The default destination port for 
